<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Classic Snake</title>
  <style>
    html,body {
      margin:0; padding:0;
      height:100%; width:100%;
      background:black;
      color:lime;
      font-family:monospace;
      overflow:hidden;
    }
    #scoreboard {
      position:absolute; top:10px; left:10px;
      font-size:18px; font-weight:bold;
    }
    canvas { display:block; }
    #message {
      position:absolute;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      color:lime;
      font-size:22px;
      font-weight:bold;
      display:none;
      text-align:center;
    }
  </style>
</head>
<body>
  <div id="scoreboard">
    Score: <span id="score">0</span>  
    High: <span id="highscore">0</span>
  </div>
  <canvas id="game"></canvas>
  <div id="message"></div>

  <script>
  (function(){
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const highEl = document.getElementById("highscore");
    const msgEl = document.getElementById("message");

    const CELL = 20;
    let COLS, ROWS;
    let snake, dir, nextDir, fruit, score, highScore, running, paused, loop;

    function resize(){
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      COLS = Math.floor(canvas.width / CELL);
      ROWS = Math.floor(canvas.height / CELL);
    }
    window.addEventListener("resize", resize);
    resize();

    highScore = Number(localStorage.getItem("snakeHigh")) || 0;
    highEl.textContent = highScore;

    function randCell(){
      return { x: Math.floor(Math.random()*COLS), y: Math.floor(Math.random()*ROWS) };
    }

    function placeFruit(){
      let pos;
      const occ = new Set(snake.map(s=>s.x+","+s.y));
      do { pos = randCell(); } while(occ.has(pos.x+","+pos.y));
      fruit = pos;
    }

    function reset(){
      snake = [{x:Math.floor(COLS/2),y:Math.floor(ROWS/2)}];
      dir = {x:1,y:0}; nextDir = {x:1,y:0};
      score = 0; running = true; paused = false;
      placeFruit();
      scoreEl.textContent = score;
      msgEl.style.display="none";
      startLoop();
    }

    function gameOver(){
      running = false; stopLoop();
      if(score > highScore){
        highScore = score;
        localStorage.setItem("snakeHigh", highScore);
        highEl.textContent = highScore;
      }
      msgEl.innerHTML = `Game Over<br/>Score: ${score}<br/>Press Enter to Restart`;
      msgEl.style.display="block";
    }

    function startLoop(){
      stopLoop();
      loop = setInterval(tick, 120);
    }
    function stopLoop(){ if(loop) clearInterval(loop); loop=null; }

    function tick(){
      if(!running || paused) return;
      if(!isOpposite(nextDir, dir)) dir = {...nextDir};
      const head = snake[0];
      const newHead = { x: head.x+dir.x, y: head.y+dir.y };

      if(newHead.x<0||newHead.x>=COLS||newHead.y<0||newHead.y>=ROWS) return gameOver();
      if(snake.some(s=>s.x===newHead.x && s.y===newHead.y)) return gameOver();

      snake.unshift(newHead);
      if(newHead.x===fruit.x && newHead.y===fruit.y){
        score++;
        scoreEl.textContent = score;
        placeFruit();
      } else {
        snake.pop();
      }
      render();
    }

    function render(){
      ctx.fillStyle="black";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      ctx.fillStyle="white";
      ctx.fillRect(fruit.x*CELL, fruit.y*CELL, CELL, CELL);

      ctx.fillStyle="lime";
      snake.forEach((s,i)=>{
        ctx.fillRect(s.x*CELL, s.y*CELL, CELL, CELL);
      });
    }

    function isOpposite(a,b){ return a.x===-b.x && a.y===-b.y; }

    window.addEventListener("keydown", e=>{
      const kd = {ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};
      if(kd[e.key]){
        const cand=kd[e.key];
        if(snake.length>1 && isOpposite(cand,dir)) return;
        nextDir=cand;
      }
      if(e.code==="Space"){ if(running) paused=!paused; }
      if(e.code==="Enter" && !running) reset();
    });

    reset();
  })();
  </script>
</body>
</html>
